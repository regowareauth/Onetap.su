--[[ 
    SKEET.CC / GAMESENSE UI LIBRARY
    Style: Dark, Code Font, Gradient Bar, Groupboxes
    Author: Velocity
]]

local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")

local Library = {}
Library.Open = true
Library.Flags = {}
Library.Theme = {
    Main = Color3.fromRGB(20, 20, 20),
    Sidebar = Color3.fromRGB(12, 12, 12),
    Groupbox = Color3.fromRGB(15, 15, 15),
    Outline = Color3.fromRGB(45, 45, 45),
    Accent = Color3.fromRGB(150, 200, 60), -- Skeet Green
    Text = Color3.fromRGB(225, 225, 225),
    TextDim = Color3.fromRGB(150, 150, 150),
}

function Library:Create(class, props)
    local obj = Instance.new(class)
    for k, v in pairs(props) do
        obj[k] = v
    end
    return obj
end

function Library:Window(name)
    local Window = {}
    
    local Screen = Library:Create("ScreenGui", {
        Name = "GamesenseUI",
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    })
    
    if pcall(function() Screen.Parent = CoreGui end) then
    else Screen.Parent = Players.LocalPlayer:WaitForChild("PlayerGui") end

    local Main = Library:Create("Frame", {
        Name = "Main",
        Parent = Screen,
        BackgroundColor3 = Library.Theme.Main,
        Position = UDim2.new(0.5, -300, 0.5, -200),
        Size = UDim2.new(0, 600, 0, 400),
        BorderSizePixel = 1,
        BorderColor3 = Library.Theme.Outline
    })

    -- Dragging
    local dragging, dragInput, dragStart, startPos
    Main.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = Main.Position
        end
    end)
    Main.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
    end)

    -- Gradient Top Bar (Rainbow)
    local TopBar = Library:Create("Frame", {
        Parent = Main,
        Size = UDim2.new(1, 0, 0, 3),
        BorderSizePixel = 0,
        BackgroundColor3 = Color3.new(1,1,1)
    })
    local Gradient = Library:Create("UIGradient", {
        Parent = TopBar,
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)),
            ColorSequenceKeypoint.new(0.2, Color3.fromRGB(255, 255, 0)),
            ColorSequenceKeypoint.new(0.4, Color3.fromRGB(0, 255, 0)),
            ColorSequenceKeypoint.new(0.6, Color3.fromRGB(0, 255, 255)),
            ColorSequenceKeypoint.new(0.8, Color3.fromRGB(0, 0, 255)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 255))
        })
    })

    -- Rainbow Animation
    task.spawn(function()
        while Screen.Parent do
            local offset = 0
            for i = 0, 1, 0.005 do
                if not Screen.Parent then break end
                Gradient.Offset = Vector2.new(i, 0)
                RunService.RenderStepped:Wait()
            end
        end
    end)

    -- Sidebar
    local Sidebar = Library:Create("Frame", {
        Parent = Main,
        BackgroundColor3 = Library.Theme.Sidebar,
        Size = UDim2.new(0, 110, 1, -3),
        Position = UDim2.new(0, 0, 0, 3),
        BorderSizePixel = 1,
        BorderColor3 = Library.Theme.Outline
    })
    
    local TabContainer = Library:Create("UIListLayout", {
        Parent = Sidebar,
        Padding = UDim.new(0, 0),
        SortOrder = Enum.SortOrder.LayoutOrder
    })

    -- Content Area
    local Content = Library:Create("Frame", {
        Parent = Main,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 120, 0, 13),
        Size = UDim2.new(1, -130, 1, -23)
    })

    -- Toggle Key (Insert)
    UserInputService.InputBegan:Connect(function(input)
        if input.KeyCode == Enum.KeyCode.Insert then
            Screen.Enabled = not Screen.Enabled
        end
    end)

    local Tabs = {}
    local FirstTab = true

    function Window:Tab(name)
        local Tab = {}
        
        local TabBtn = Library:Create("TextButton", {
            Parent = Sidebar,
            BackgroundColor3 = Library.Theme.Sidebar,
            Size = UDim2.new(1, 0, 0, 40),
            Text = name:upper(),
            Font = Enum.Font.Code,
            TextColor3 = Library.Theme.TextDim,
            TextSize = 13,
            BorderSizePixel = 0,
            AutoButtonColor = false
        })
        
        -- Selected Indicator
        local Indicator = Library:Create("Frame", {
            Parent = TabBtn,
            BackgroundColor3 = Library.Theme.Accent,
            Size = UDim2.new(0, 2, 1, 0),
            Visible = false,
            BorderSizePixel = 0
        })

        local TabPage = Library:Create("ScrollingFrame", {
            Parent = Content,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            Visible = false,
            ScrollBarThickness = 2,
            CanvasSize = UDim2.new(0,0,0,0)
        })

        -- Columns
        local LeftCol = Library:Create("Frame", {Parent = TabPage, BackgroundTransparency = 1, Size = UDim2.new(0.48, 0, 1, 0)})
        local RightCol = Library:Create("Frame", {Parent = TabPage, BackgroundTransparency = 1, Size = UDim2.new(0.48, 0, 1, 0), Position = UDim2.new(0.52, 0, 0, 0)})
        
        local LL = Library:Create("UIListLayout", {Parent = LeftCol, Padding = UDim.new(0, 10), SortOrder = Enum.SortOrder.LayoutOrder})
        local RL = Library:Create("UIListLayout", {Parent = RightCol, Padding = UDim.new(0, 10), SortOrder = Enum.SortOrder.LayoutOrder})

        -- Auto Resize
        local function Resize()
            local maxH = math.max(LL.AbsoluteContentSize.Y, RL.AbsoluteContentSize.Y)
            TabPage.CanvasSize = UDim2.new(0,0,0, maxH + 20)
        end
        LL:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(Resize)
        RL:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(Resize)

        if FirstTab then
            TabBtn.TextColor3 = Library.Theme.Text
            TabBtn.BackgroundColor3 = Library.Theme.Main
            Indicator.Visible = true
            TabPage.Visible = true
            FirstTab = false
        end

        TabBtn.MouseButton1Click:Connect(function()
            for _, t in pairs(Tabs) do
                t.Btn.TextColor3 = Library.Theme.TextDim
                t.Btn.BackgroundColor3 = Library.Theme.Sidebar
                t.Ind.Visible = false
                t.Page.Visible = false
            end
            TabBtn.TextColor3 = Library.Theme.Text
            TabBtn.BackgroundColor3 = Library.Theme.Main
            Indicator.Visible = true
            TabPage.Visible = true
        end)
        
        table.insert(Tabs, {Btn = TabBtn, Ind = Indicator, Page = TabPage})

        function Tab:Section(title)
            local Section = {}
            -- Auto Column Selection
            local Parent = (LL.AbsoluteContentSize.Y <= RL.AbsoluteContentSize.Y) and LeftCol or RightCol
            
            local SFrame = Library:Create("Frame", {
                Parent = Parent,
                BackgroundColor3 = Library.Theme.Groupbox,
                BorderColor3 = Library.Theme.Outline,
                Size = UDim2.new(1, 0, 0, 50) -- Resized later
            })
            
            -- Skeet Style Title (Cut into border)
            local TitleBG = Library:Create("Frame", {
                Parent = SFrame,
                BackgroundColor3 = Library.Theme.Groupbox,
                BorderSizePixel = 0,
                Position = UDim2.new(0, 10, 0, -1),
                Size = UDim2.new(0, 0, 0, 2), -- Width set dynamically
                ZIndex = 2
            })
            
            local TitleLbl = Library:Create("TextLabel", {
                Parent = SFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 14, 0, -8),
                Text = title,
                TextColor3 = Library.Theme.Text,
                Font = Enum.Font.Code,
                TextSize = 12,
                Size = UDim2.new(0, 0, 0, 15),
                ZIndex = 3,
                AutomaticSize = Enum.AutomaticSize.X
            })
            
            -- Adjust BG width to cover border
            TitleLbl:GetPropertyChangedSignal("AbsoluteSize"):Connect(function()
                TitleBG.Size = UDim2.new(0, TitleLbl.AbsoluteSize.X + 8, 0, 2)
            end)

            local Container = Library:Create("Frame", {
                Parent = SFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 10, 0, 15),
                Size = UDim2.new(1, -20, 1, -20)
            })
            
            local List = Library:Create("UIListLayout", {
                Parent = Container,
                Padding = UDim.new(0, 6),
                SortOrder = Enum.SortOrder.LayoutOrder
            })
            
            List:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
                SFrame.Size = UDim2.new(1, 0, 0, List.AbsoluteContentSize.Y + 25)
            end)

            function Section:Toggle(name, default, callback)
                local Toggle = {}
                local state = default or false
                
                local Btn = Library:Create("TextButton", {
                    Parent = Container,
                    BackgroundTransparency = 1,
                    Size = UDim2.new(1, 0, 0, 20),
                    Text = "",
                    AutoButtonColor = false
                })
                
                local Box = Library:Create("Frame", {
                    Parent = Btn,
                    BackgroundColor3 = Library.Theme.Sidebar,
                    BorderColor3 = Library.Theme.Outline,
                    Size = UDim2.new(0, 12, 0, 12),
                    Position = UDim2.new(0, 0, 0.5, -6)
                })
                
                local Gradient = Library:Create("UIGradient", {
                    Parent = Box,
                    Color = ColorSequence.new(Library.Theme.Accent),
                    Rotation = 90,
                    Enabled = false
                })

                local Label = Library:Create("TextLabel", {
                    Parent = Btn,
                    BackgroundTransparency = 1,
                    Position = UDim2.new(0, 20, 0, 0),
                    Size = UDim2.new(1, -20, 1, 0),
                    Text = name,
                    Font = Enum.Font.Code,
                    TextSize = 12,
                    TextColor3 = Library.Theme.TextDim,
                    TextXAlignment = Enum.TextXAlignment.Left
                })

                local function Update()
                    Gradient.Enabled = state
                    Label.TextColor3 = state and Library.Theme.Text or Library.Theme.TextDim
                    if state then
                        Box.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                        Box.BorderColor3 = Color3.fromRGB(0,0,0)
                    else
                        Box.BackgroundColor3 = Library.Theme.Sidebar
                        Box.BorderColor3 = Library.Theme.Outline
                    end
                    if callback then callback(state) end
                end

                if default then Update() end

                Btn.MouseButton1Click:Connect(function()
                    state = not state
                    Update()
                end)
            end

            function Section:Button(name, callback)
                local Btn = Library:Create("TextButton", {
                    Parent = Container,
                    BackgroundColor3 = Library.Theme.Sidebar,
                    BorderColor3 = Library.Theme.Outline,
                    Size = UDim2.new(1, 0, 0, 22),
                    Text = name,
                    Font = Enum.Font.Code,
                    TextSize = 12,
                    TextColor3 = Library.Theme.Text
                })
                
                Btn.MouseButton1Click:Connect(function()
                    callback()
                end)
            end

            function Section:Slider(name, min, max, default, callback)
                local Slider = {}
                local val = default or min
                
                local Frame = Library:Create("Frame", {
                    Parent = Container,
                    BackgroundTransparency = 1,
                    Size = UDim2.new(1, 0, 0, 35)
                })
                
                local Label = Library:Create("TextLabel", {
                    Parent = Frame,
                    BackgroundTransparency = 1,
                    Size = UDim2.new(1, 0, 0, 15),
                    Text = name,
                    Font = Enum.Font.Code,
                    TextColor3 = Library.Theme.TextDim,
                    TextSize = 12,
                    TextXAlignment = Enum.TextXAlignment.Left
                })
                
                local ValLbl = Library:Create("TextLabel", {
                    Parent = Frame,
                    BackgroundTransparency = 1,
                    Size = UDim2.new(1, 0, 0, 15),
                    Text = tostring(val),
                    Font = Enum.Font.Code,
                    TextColor3 = Library.Theme.Text,
                    TextSize = 12,
                    TextXAlignment = Enum.TextXAlignment.Right
                })

                local BarBG = Library:Create("TextButton", {
                    Parent = Frame,
                    BackgroundColor3 = Library.Theme.Sidebar,
                    BorderColor3 = Library.Theme.Outline,
                    Position = UDim2.new(0, 0, 0, 18),
                    Size = UDim2.new(1, 0, 0, 8),
                    Text = "",
                    AutoButtonColor = false
                })
                
                local Fill = Library:Create("Frame", {
                    Parent = BarBG,
                    BackgroundColor3 = Library.Theme.Accent,
                    BorderSizePixel = 0,
                    Size = UDim2.new((val - min) / (max - min), 0, 1, 0)
                })

                local dragging = false
                
                local function Update(input)
                    local pos = math.clamp((input.Position.X - BarBG.AbsolutePosition.X) / BarBG.AbsoluteSize.X, 0, 1)
                    val = math.floor(((pos * (max - min)) + min) * 10) / 10
                    Fill.Size = UDim2.new(pos, 0, 1, 0)
                    ValLbl.Text = tostring(val)
                    if callback then callback(val) end
                end

                BarBG.InputBegan:Connect(function(i)
                    if i.UserInputType == Enum.UserInputType.MouseButton1 then
                        dragging = true
                        Update(i)
                    end
                end)
                UserInputService.InputChanged:Connect(function(i)
                    if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
                        Update(i)
                    end
                end)
                UserInputService.InputEnded:Connect(function(i)
                    if i.UserInputType == Enum.UserInputType.MouseButton1 then
                        dragging = false
                    end
                end)
            end

            return Section
        end
        return Tab
    end
    return Window
end

return Library
